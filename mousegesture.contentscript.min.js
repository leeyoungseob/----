/**
 * Copyright 2016 NAVER Corp. All Rights reserved.
 * All rights, including but not limited to, copyrights,
 * and intellectual property rights of this source code are owned by NAVER Corp.
 *
 * You may not use, reproduce, modify, or distribute this source code
 * without prior written permission from NAVER Corp.
 */"use strict";wl.StrokeCanvas=function(){function a(){k.canvas=document.createElement("canvas"),k.canvas.style.cssText="position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 2147483645;",k.canvas.width="BackCompat"===document.compatMode?document.body.clientWidth:document.documentElement.clientWidth,k.canvas.height="BackCompat"===document.compatMode?document.body.clientHeight:document.documentElement.clientHeight,k.ctx=k.canvas.getContext("2d"),k.ctx.shadowBlur=15,k.ctx.shadowColor="rgba(255, 255, 255, 0.5)",k.ctx.lineJoin=k.ctx.lineCap="round"}function b(b){k.canvas||a(),k.ctx.strokeStyle=k.lineColor,j.length=0,j.push({x:b.x,y:b.y,width:b.width||h(3,5)}),wl.ShadowRoot.appendChild(k.canvas)}function c(a){j.push({x:a.x,y:a.y,width:a.width||h(3,5)}),g(),f()}function d(a){k.lineColor=i(a)}function e(){g(),k.canvas&&k.canvas.parentNode&&k.canvas.parentNode.removeChild(k.canvas),j.length=0,k.canvas=void 0,k.ctx=void 0}function f(){if(k.ctx)for(var a=1,b=j.length;a<b;a++)k.ctx.beginPath(),k.ctx.moveTo(j[a-1].x,j[a-1].y),k.ctx.lineWidth=j[a].width,k.ctx.lineTo(j[a].x,j[a].y),k.ctx.stroke()}function g(){k.ctx&&k.ctx.clearRect(0,0,k.ctx.canvas.width,k.ctx.canvas.height)}function h(a,b){return Math.floor(Math.random()*(b-a+1))+a}function i(a){if(!Number.isInteger(a))return a;var b={r:parseFloat((16711680&a)>>16)/255*255,g:parseFloat((65280&a)>>8)/255*255,b:parseFloat(255&a)/255*255};return["#",b.r.toString(16),b.g.toString(16),b.b.toString(16)].join("")}var j=[],k={};return{start:b,lineTo:c,lineColor:d,stop:e}}(),wl.MouseGesture=function(){function a(a){Object.assign(z,a),c()}function b(){s(),d()}function c(){document.documentElement.addEventListener("mousedown",h,!0),document.documentElement.addEventListener("contextmenu",k,!0)}function d(){document.documentElement.removeEventListener("mousedown",h,!0),document.documentElement.removeEventListener("contextmenu",k,!0)}function e(){document.documentElement.addEventListener("mousemove",i,!0),document.documentElement.addEventListener("mouseup",j,!0),document.documentElement.addEventListener("mousewheel",g,!0)}function f(){document.documentElement.removeEventListener("mousemove",i,!0),document.documentElement.removeEventListener("mouseup",j,!0),document.documentElement.removeEventListener("mousewheel",g,!0)}function g(){if(u())return o()}function h(a){t(a)&&l(a)}function i(a){return t(a)?void m(a):o()}function j(a){A?(n(a),setTimeout(s,100)):(n(a),s(),B=a.timeStamp)}function k(a){if(A)v()&&r(a);else{var b=a.timeStamp-B<z.dblClickTime;!v()&&b?(s(),p(),f()):r(a),B=a.timeStamp}}function l(a){y.directions=[],y.lastX=a.clientX,y.lastY=a.clientY,q(),e(),w("gesturestart",{position:{x:a.clientX,y:a.clientY}})}function m(a){var b="",c=Math.abs(a.clientX-y.lastX),d=Math.abs(a.clientY-y.lastY);c<z.minLength&&d<z.minLength||(b=c>d?a.clientX<y.lastX?x.LEFT:x.RIGHT:a.clientY<y.lastY?x.UP:x.DOWN,b!==y.lastDirection?(y.lastDirection=b,y.directions.push(b),y.directionChanged=!1):y.directionChanged=!0,w("gesturemove",{input:b,directions:y.directions,changed:y.directionChanged,position:{x:a.clientX,y:a.clientY}}),y.lastX=a.clientX,y.lastY=a.clientY)}function n(a){v()&&(w("gestureend",{input:y.directions.join(""),directions:y.directions,position:{x:a.clientX,y:a.clientY}}),r(a)),p(),setTimeout(f,0)}function o(){s(),p(),f(),w("gesturecancel")}function p(){0===z.mouseButton&&document.documentElement.removeEventListener("selectstart",r)}function q(){0===z.mouseButton&&document.documentElement.addEventListener("selectstart",r)}function r(a){return a.preventDefault(),!1}function s(){y={}}function t(a){var b=a.button===z.mouseButton;return z.useCtrlKey?(a.ctrlKey||a.metaKey)&&b:z.useAltKey?a.altKey&&b:b}function u(){return Array.isArray(y.directions)}function v(){return y&&y.directions&&y.directions.length>0}function w(a,b){document.documentElement.dispatchEvent(new CustomEvent(a,{detail:b}))}var x={LEFT:"L",RIGHT:"R",UP:"U",DOWN:"D"},y={},z={useCtrlKey:!1,useAltKey:!1,mouseButton:0,minLength:10,dblClickTime:500},A=navigator.platform.toLowerCase().includes("win"),B=void 0;return{enable:a,disable:b}}(),wl.ToastMessage=function(){function a(){g=document.createElement("toast"),g.className="toast"}function b(b,c){g||a(),g.style.transition="none",g.style.opacity=1,g.innerHTML=b,g.parentNode||wl.ShadowRoot.appendChild(g),e(),c&&d()}function c(a){g&&(g.style.transition=a?"none":"opacity "+h+"ms cubic-bezier(0.23, 1, 0.32, 1)",g.style.opacity=0,a?f(g):i.removeChild=setTimeout(function(){f(g),i.removeChild=null},h))}function d(){i.autoHide&&(clearTimeout(i.autoHide),i.autoHide=null),i.autoHide=setTimeout(c,h)}function e(){for(var a in i)i.hasOwnProperty(a)&&i[a]&&(clearTimeout(i[a]),i[a]=null)}function f(a){a.parentNode&&a.parentNode.removeChild(a)}var g=void 0,h=300,i={autoHide:null,removeChild:null};return{show:b,hide:c}}(),function(){function a(){return!!b()&&(wl.RuntimeMessage.send("mousegesture.whomi").then(function(a){w.currentTabId=a.tab&&a.tab.id}),wl.Preferences.get([r]).then(function(a){a&&a[r]&&c()}),void wl.Preferences.onChanged.addListener(function(a){a&&("undefined"!=typeof a[t]&&(w.useStroke=a[t]),"undefined"!=typeof a[s]&&h(a[s]),"undefined"!=typeof a[r]&&(a[r]?c():d()))},q))}function b(){var a=navigator.userAgent.toLowerCase();return!(a.includes("mobile")||a.includes("sidebar")||a.includes("inline_login")||a.includes("webpanel"))}function c(){wl.Preferences.get([s,t]).then(function(a){e(),wl.MouseGesture.enable({mouseButton:2}),w.useStroke=a[t],h(a[s]),i(),g(),p()})}function d(){wl.MouseGesture.disable(),f()}function e(){document.documentElement.addEventListener("gesturestart",j),document.documentElement.addEventListener("gesturemove",k),document.documentElement.addEventListener("gestureend",l),document.documentElement.addEventListener("gesturecancel",m)}function f(){document.documentElement.removeEventListener("gesturestart",j),document.documentElement.removeEventListener("gesturemove",k),document.documentElement.removeEventListener("gestureend",l),document.documentElement.removeEventListener("gesturecancel",m)}function g(){wl.StrokeCanvas.lineColor(u),wl.RuntimeMessage.send("mousegesture.color").then(function(a){a&&wl.StrokeCanvas.lineColor(a)})}function h(a){v={},a.forEach(function(a){v[a.gesture]=a.action})}function i(){window===window.top&&(w.isListeningToast||(w.isListeningToast=!0,wl.RuntimeMessage.listen("mousegesture.toast",function(a){w.currentTabId===a.tabId&&a.action?wl.ToastMessage.show(o(a),a.autoHide):wl.ToastMessage.hide(!0)})))}function j(a){w.useStroke&&wl.StrokeCanvas.start(a.detail.position)}function k(a){if(w.useStroke){var b=5;wl.StrokeCanvas.lineTo({x:a.detail.position.x,y:a.detail.position.y,width:b}),w.previousMove=a}n(a.detail.directions,!1)}function l(a){w.useStroke&&wl.StrokeCanvas.stop(),n(a.detail.directions,!0)}function m(){w.useStroke&&wl.StrokeCanvas.stop(),wl.RuntimeMessage.send("mousegesture.toast",{action:!1})}function n(a,b){var c=a.join(""),d=v&&v[c];wl.RuntimeMessage.send("mousegesture.toast",d?{action:v[c],autoHide:b,directions:a}:{action:!1}),v[c]&&b&&wl.RuntimeMessage.send("mousegesture.action",{action:v[c]})}function o(a){var b=whale.i18n.getMessage("EXTENSION_MOUSEGESTURE_ACTION_"+a.action),c=a.directions.join("").toLowerCase();return'<p class="__whale__"><i class="mg_icon '+c+'"></i><span class="message">'+b+"</span></p>"}function p(){w.isListeningDeleg||(w.isListeningDeleg=!0,wl.RuntimeMessage.listen("mousegesture.delegate",function(a){if(a&&a.action){var b=window===window.top,c=!b&&Math.abs(document.documentElement.scrollHeight-document.documentElement.clientHeight)<20;try{switch(a.action){case"HOMEPAGE_WEBPANEL":b&&whale.sidebars.goHome();break;case"CLOSE_WEBPANEL":b&&whale.sidebars.close();break;case"JUMPTO_TOP":c?wl.RuntimeMessage.send("mousegesture.action",{action:a.action+"_OFWINDOW"}):window.scrollTo(document.documentElement.scrollLeft||document.body.scrollLeft,0);break;case"JUMPTO_BOTTOM":c?wl.RuntimeMessage.send("mousegesture.action",{action:a.action+"_OFWINDOW"}):window.scrollTo(document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollHeight)}}catch(a){}}}))}var q="mousegesture",r=q+".enabled",s=q+".gestures",t=q+".usestroke",u="#cccccc",v=void 0,w={useStroke:!1,isListeningDeleg:!1,isListeningToast:!1};a()}(),function(){function a(){return!!b()&&(wl.Preferences.get([q]).then(function(a){a&&a[q]&&c()}),void wl.Preferences.onChanged.addListener(function(a){a&&("undefined"!=typeof a[s]&&(x.useStroke=a[s]),"undefined"!=typeof a[r]&&h(a[r]),"undefined"!=typeof a[q]&&(a[q]?c():d()))},p))}function b(){return navigator.userAgent.toLowerCase().includes("webpanel")}function c(){wl.Preferences.get([r,s]).then(function(a){e(),wl.MouseGesture.enable({mouseButton:2}),x.useStroke=a[s],h(a[r]),g()})}function d(){wl.MouseGesture.disable(),f()}function e(){document.documentElement.addEventListener("gesturestart",i),document.documentElement.addEventListener("gesturemove",j),document.documentElement.addEventListener("gestureend",k),document.documentElement.addEventListener("gesturecancel",l)}function f(){document.documentElement.removeEventListener("gesturestart",i),document.documentElement.removeEventListener("gesturemove",j),document.documentElement.removeEventListener("gestureend",k),document.documentElement.removeEventListener("gesturecancel",l)}function g(){wl.StrokeCanvas.lineColor(t),wl.RuntimeMessage.send("mousegesture.color").then(function(a){a&&wl.StrokeCanvas.lineColor(a)})}function h(a){w={},a.forEach(function(a){w[a.gesture]=a.action})}function i(a){x.useStroke&&wl.StrokeCanvas.start(a.detail.position)}function j(a){if(x.useStroke){var b=5;wl.StrokeCanvas.lineTo({x:a.detail.position.x,y:a.detail.position.y,width:b}),x.previousMove=a}m(a.detail.directions,!1)}function k(a){x.useStroke&&wl.StrokeCanvas.stop(),m(a.detail.directions,!0)}function l(){x.useStroke&&wl.StrokeCanvas.stop(),n({action:!1})}function m(a,b){var c=a.join(""),d=w&&w[c]&&x.availableActions.includes(w[c]);if(n(d?{action:w[c],autoHide:b,directions:a}:{action:!1}),d&&b)try{u[w[c]]()}catch(a){}}function n(a){window===window.top&&(a.action?wl.ToastMessage.show(o(a),a.autoHide):wl.ToastMessage.hide(!0))}function o(a){var b=v[a.action]||a.action,c=whale.i18n.getMessage("EXTENSION_MOUSEGESTURE_ACTION_"+b),d=a.directions.join("").toLowerCase();return'<p class="__whale__"><i class="mg_icon '+d+'"></i><span class="message">'+c+"</span></p>"}var p="mousegesture",q=p+".enabled",r=p+".gestures",s=p+".usestroke",t="#cccccc",u={JUMPTO_TOP:function(){window.scrollTo(0,0)},JUMPTO_BOTTOM:function(){window.scrollTo(0,document.documentElement.scrollHeight)},REFRESH:function(){location.reload()},BACK:function(){history.back()},FORWARD:function(){history.forward()},HOMEPAGE:function(){wl.RuntimeMessage.send("mousegesture.action",{action:"HOMEPAGE_WEBPANEL"})},CLOSE_TAB:function(){wl.RuntimeMessage.send("mousegesture.action",{action:"CLOSE_WEBPANEL"})},NEW_TAB:function(){wl.RuntimeMessage.send("mousegesture.action",{action:"OPENIN_NEW_TAB"})}},v={NEW_TAB:"OPENIN_NEW_TAB",CLOSE_TAB:"CLOSE_WEBPANEL"},w=void 0,x={useStroke:!1,availableActions:["JUMPTO_TOP","JUMPTO_BOTTOM","REFRESH","BACK","FORWARD","HOMEPAGE","CLOSE_TAB","NEW_TAB"]};a()}();